# ì‹¤ìŠµ: FastAPI íŒŒë¼ë¯¸í„° ì§ì ‘ êµ¬í˜„í•´ë³´ê¸°

ì´ê³³ì—ì„œ í•˜ë‚˜ì”© ì§ì ‘ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©° ìµí˜€ë´…ì‹œë‹¤.

## ë¯¸ì…˜ 0: ê¸°ë³¸ ì„¤ì • ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸

FastAPIë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ê¸°ë³¸ì ì¸ ì¤€ë¹„ ë‹¨ê³„ì…ë‹ˆë‹¤.

**ëª©í‘œ**:
1. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„í¬íŠ¸í•˜ì„¸ìš” (`FastAPI`, `uvicorn`, `nest_asyncio`, `BaseModel` ë“±).
2. `src` í´ë”ì— ìˆëŠ” ìš°ë¦¬ì˜ ì»¤ìŠ¤í…€ ë¡œê¹… ëª¨ë“ˆ(`module_01_fastapi_log_to_loguru`)ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.
3. ë¡œê¹…ì„ ì„¤ì •(`setup_logging()`)í•˜ê³ , `app`ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ FastAPI ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì„¸ìš”.


```python
# ì—¬ê¸°ì— ë¯¸ì…˜ 0 ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”
import sys
from fastapi import FastAPI
import uvicorn
import nest_asyncio
from loguru import logger
sys.path.append("src")

from module_01_fastapi_log_to_loguru import setup_logging

nest_asyncio.apply()
setup_logging()

app = FastAPI()

```

    [32m2025-12-03 21:24:19.473[0m | [1mINFO    [0m | [36mmodule_01_fastapi_log_to_loguru[0m:[36msetup_logging[0m:[36m77[0m - [1mLogging ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.[0m
    

## ë¯¸ì…˜ 1: Pydantic ëª¨ë¸(BaseModel) ì •ì˜í•˜ê¸°

ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ë•Œ ì‚¬ìš©í•  ë°ì´í„°ì˜ í˜•ì‹ì„ ì •ì˜í•©ë‹ˆë‹¤.

**ëª©í‘œ**:
1. `pydantic`ì—ì„œ `BaseModel`ì„ ìƒì†ë°›ëŠ” `Item` í´ë˜ìŠ¤ë¥¼ ë§Œë“œì„¸ìš”.
2. `Item` í´ë˜ìŠ¤ëŠ” `name` (ë¬¸ìì—´)ê³¼ `price` (ìˆ«ì) í•„ë“œë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.

> **ğŸ’¡ íŒíŠ¸**
> - í´ë˜ìŠ¤ ìƒì† ë¬¸ë²•: `class í´ë˜ìŠ¤ì´ë¦„(ë¶€ëª¨í´ë˜ìŠ¤):`
> - íƒ€ì… íŒíŠ¸ ë¬¸ë²•: `ë³€ìˆ˜ëª…: íƒ€ì…` (ì˜ˆ: `age: int`)


```python
# ì—¬ê¸°ì— ë¯¸ì…˜ 1 ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”
from pydantic import BaseModel
class Item(BaseModel):
    name: str
    price: int = 5000

```

## ë¯¸ì…˜ 2: Path Parameterì™€ ëª¨ë¸ ì‚¬ìš©í•˜ê¸°

URL ê²½ë¡œë¡œ ì•„ì´ë””ë¥¼ ë°›ê³ , ì‘ë‹µìœ¼ë¡œëŠ” ë°©ê¸ˆ ë§Œë“  `Item` ëª¨ë¸ì„ ëŒë ¤ì£¼ëŠ” APIë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

**ëª©í‘œ**: 
1. `GET` ë©”ì„œë“œë¡œ `/items/{item_id}` ê²½ë¡œë¥¼ ë§Œë“œì„¸ìš”.
2. `item_id`ë¥¼ í•¨ìˆ˜ì˜ ì¸ìë¡œ ë°›ìœ¼ì„¸ìš”.
3. í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `Item` ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë¦¬í„´í•˜ì„¸ìš”. (ì´ë¦„ê³¼ ê°€ê²©ì€ ììœ ë¡­ê²Œ ë„£ìœ¼ì„¸ìš”)

> **ğŸ’¡ íŒíŠ¸**
> - ë°ì½”ë ˆì´í„°: `@app.get("...")`
> - ê²½ë¡œ ë³€ìˆ˜: ì¤‘ê´„í˜¸ `{}` ì‚¬ìš©
> - ë¦¬í„´ ê°’: `Item(...)` ê°ì²´ë¥¼ ë°”ë¡œ ë¦¬í„´í•˜ë©´ FastAPIê°€ ì•Œì•„ì„œ JSONìœ¼ë¡œ ë°”ê¿”ì¤ë‹ˆë‹¤.


```python
# ì—¬ê¸°ì— ë¯¸ì…˜ 2 ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”
@app.get("/items/{item_id}")
def read_item_id(item_id):
    item = Item(name="item_" + str(item_id))
    return item



```

## ë¯¸ì…˜ 3: Query Parameter (ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜)

URL ê²½ë¡œì—ëŠ” ì—†ì§€ë§Œ `?key=value` í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ë°›ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
ê²€ìƒ‰ í•„í„°ë‚˜ í˜ì´ì§€ë„¤ì´ì…˜(page, limit) ë“±ì— ì£¼ë¡œ ì“°ì…ë‹ˆë‹¤.

**ì‘ë™ ì›ë¦¬**:
ê²½ë¡œ(`{}`)ì— ì—†ëŠ” ë³€ìˆ˜ë¥¼ í•¨ìˆ˜ ì¸ìë¡œ ì„ ì–¸í•˜ë©´, FastAPIëŠ” ìë™ìœ¼ë¡œ **ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜**ë¡œ ì¸ì‹í•©ë‹ˆë‹¤.

**ëª©í‘œ**:
1. `GET` ë©”ì„œë“œë¡œ `/users/` ê²½ë¡œë¥¼ ë§Œë“œì„¸ìš”.
2. `skip` (ì •ìˆ˜, ê¸°ë³¸ê°’ 0)ê³¼ `limit` (ì •ìˆ˜, ê¸°ë³¸ê°’ 10)ì„ í•¨ìˆ˜ ì¸ìë¡œ ë°›ìœ¼ì„¸ìš”.
3. ë°›ì€ `skip`ê³¼ `limit`ì„ í¬í•¨í•œ ë”•ì…”ë„ˆë¦¬ë¥¼ ë¦¬í„´í•˜ì„¸ìš”.

> **ğŸ’¡ íŒíŠ¸**
> - ê²½ë¡œì—ëŠ” `{}`ë¥¼ ì“°ì§€ ì•ŠìŠµë‹ˆë‹¤: `@app.get("/users/")`
> - í•¨ìˆ˜ ì¸ìì— ê¸°ë³¸ê°’ì„ ì£¼ë©´ ì„ íƒì (Optional) íŒŒë¼ë¯¸í„°ê°€ ë©ë‹ˆë‹¤: `def read_users(skip: int = 0, ...):`
> - í…ŒìŠ¤íŠ¸ URL ì˜ˆì‹œ: `http://127.0.0.1:8000/users/?skip=20&limit=5`


```python
# ì—¬ê¸°ì— ë¯¸ì…˜ 3 ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”
@app.get("/user/")
def read_user(skip: int = 0,limit: int = 10):
    return {"skip": skip, "limit": limit}

```

## ë¯¸ì…˜ 4: Request Body (ìš”ì²­ ë°”ë””)

í´ë¼ì´ì–¸íŠ¸ê°€ JSON ë°ì´í„°ë¥¼ ë³´ë‚´ë©´, ê·¸ê±¸ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
ì£¼ë¡œ ë°ì´í„°ë¥¼ ìƒì„±(`POST`)í•˜ê±°ë‚˜ ìˆ˜ì •(`PUT`)í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

**ì‘ë™ ì›ë¦¬**:
í•¨ìˆ˜ ì¸ìì˜ íƒ€ì…ìœ¼ë¡œ **Pydantic ëª¨ë¸**(`Item` ë“±)ì„ ì§€ì •í•˜ë©´, FastAPIëŠ” "ì•„, ìš”ì²­ ë°”ë””(Body)ì— JSONìœ¼ë¡œ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ê² êµ¬ë‚˜!" í•˜ê³  ì¸ì‹í•©ë‹ˆë‹¤.

**ëª©í‘œ**:
1. `POST` ë©”ì„œë“œë¡œ `/items/` ê²½ë¡œë¥¼ ë§Œë“œì„¸ìš”. (ì£¼ì˜: `GET`ì´ ì•„ë‹ˆë¼ `POST`ì…ë‹ˆë‹¤!)
2. í•¨ìˆ˜ ì¸ìë¡œ `item: Item`ì„ ë°›ìœ¼ì„¸ìš”. (ë¯¸ì…˜ 1ì—ì„œ ë§Œë“  `Item` í´ë˜ìŠ¤ ì‚¬ìš©)
3. ë°›ì€ `item` ê°ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë¦¬í„´í•˜ì„¸ìš”.

> **ğŸ’¡ íŒíŠ¸**
> - ë°ì½”ë ˆì´í„°: `@app.post("/items/")`
> - í•¨ìˆ˜ ì¸ì: `def create_item(item: Item):`
> - **í…ŒìŠ¤íŠ¸ ë°©ë²•**: ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ìœ¼ë¡œëŠ” POST ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
>   - `http://127.0.0.1:8000/docs` (Swagger UI)ì— ì ‘ì†í•´ì„œ í…ŒìŠ¤íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.
>   - 'Try it out' ë²„íŠ¼ì„ ëˆ„ë¥´ê³  JSON ë°ì´í„°ë¥¼ ì…ë ¥í•´ì„œ 'Execute' í•´ë³´ì„¸ìš”.


```python
# ì—¬ê¸°ì— ë¯¸ì…˜ 4 ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”
@app.post("/items/")
def create_item(item: Item):
    logger.info(item)
    return item

```


```python
# ì„œë²„ ì‹¤í–‰ ì½”ë“œ (ëª¨ë“  ë¯¸ì…˜ ì½”ë“œë¥¼ ì‘ì„±í•œ í›„ ì‹¤í–‰í•˜ì„¸ìš”)
if __name__ == "__main__":
    config = uvicorn.Config(app, host="127.0.0.1", port=8000, log_config=None)
    server = uvicorn.Server(config=config)
    await server.serve()
```
